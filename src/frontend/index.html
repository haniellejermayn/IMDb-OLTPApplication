<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frontend Development Guide - MCO2</title>
</head>
<body>
    <h1>MCO2 Frontend Development Guide</h1>
    <p><strong>Backend API:</strong> <code>http://localhost:5000</code></p>
    <p><strong>Reference:</strong> See <code>src/backend/app.py</code> for all endpoints</p>

    <hr>

    <h2>API Endpoints</h2>

    <h3>Health & Status</h3>
    <ul>
        <li><code>GET /health</code> - Node health status (online/offline, record counts)</li>
        <li><code>GET /recovery/status</code> - Pending replication count</li>
        <li><code>GET /logs?limit=50</code> - Transaction logs</li>
    </ul>

    <h3>CRUD Operations</h3>
    <ul>
        <li><code>GET /titles?page=1&limit=20&type=movie</code> - List titles with pagination</li>
        <li><code>GET /titles/search?q=matrix&year_from=1990&type=movie&genre=Action</code> - Search with filters</li>
        <li><code>GET /title/{tconst}</code> - Get single title</li>
        <li><code>POST /title</code> - Create title (body: {tconst, title_type, primary_title, start_year, runtime_minutes, genres})</li>
        <li><code>PUT /title/{tconst}?isolation=READ COMMITTED</code> - Update title</li>
        <li><code>DELETE /title/{tconst}</code> - Delete title</li>
    </ul>

    <h3>Concurrency Tests (Step 3)</h3>
    <ul>
        <li>☐ <strong>Case 1 Button</strong>: "Test Concurrent Reads" 
            - Shows multiple nodes reading same record simultaneously
            - Display: consistency check, read times, isolation level used
        </li>
        
        <li>☐ <strong>Case 2 Button</strong>: "Test Read-While-Write" 
            - Shows readers trying to read while a writer updates
            - Display: dirty reads detected, blocking observed, repeatable reads
        </li>
        
        <li>☐ <strong>Case 3 Button</strong>: "Test Concurrent Writes" 
            - Shows MULTIPLE writers updating THE SAME record
            - Display: deadlocks, serialization, which writer won
            - **CRITICAL**: Make it clear this tests write conflicts on ONE record
        </li>
        
        <li>☐ <strong>Isolation Level Comparison</strong>: 
            - Dropdown or buttons for each level
            - Side-by-side results showing behavior differences
            - Recommendation for "best" level with justification
        </li>
    </ul>

    <h3>For Demo - Make This Visual!</h3>
    <ul>
        <li>☐ Show node health with colored indicators (green/yellow/red)</li>
        <li>☐ Real-time log of operations (like a console/terminal output)</li>
        <li>☐ **Pending replication counter** that updates automatically</li>
        <li>☐ For concurrency tests: Show threads/transactions side-by-side with timing</li>
        <li>☐ For recovery: Show "Node Offline" → operation → "Queued" → recover → "Synced"</li>
    </ul>

    <h3>Recovery Tests (Step 4)</h3>
    <ul>
        <li><code>POST /test/failure/fragment-to-central</code> - Case 1: Get instructions for simulating central failure</li>
        <li><code>POST /test/failure/central-recovery</code> - Case 2: Trigger central node recovery</li>
        <li><code>POST /test/failure/central-to-fragment</code> - Case 3: Get instructions for simulating fragment failure</li>
        <li><code>POST /test/failure/fragment-recovery</code> - Case 4: Trigger fragment recovery
            <br>Body: <code>{"node": "node2"}</code> or <code>{"node": "node3"}</code>
        </li>
    </ul>

    <hr>

    <h2>Frontend Checklist</h2>

    <h3>Required Pages</h3>
    <ul>
        <li>☐ <strong>Dashboard</strong> - Node health display, pending replications count</li>
        <li>☐ <strong>Titles Browser</strong> - List, search, pagination</li>
        <li>☐ <strong>Title Form</strong> - Create/Edit title</li>
        <li>☐ <strong>Concurrency Tests</strong> - Run test cases 1-3, select isolation level, display results</li>
        <li>☐ <strong>Recovery Tests</strong> - Run test cases 1-4, display instructions and results</li>
        <li>☐ <strong>Transaction Logs</strong> - View replication history</li>
    </ul>

    <h3>Required Features</h3>
    <ul>
        <li>☐ CRUD: Create, Read, Update, Delete titles</li>
        <li>☐ Search with filters (title, year range, type, genre)</li>
        <li>☐ Pagination for titles list</li>
        <li>☐ Node health indicators (green/red for online/offline)</li>
        <li>☐ Isolation level dropdown (READ UNCOMMITTED, READ COMMITTED, REPEATABLE READ, SERIALIZABLE)</li>
        <li>☐ Display which node served each request (check "source" field in responses)</li>
        <li>☐ Display test results in readable format</li>
    </ul>

    <h3>For Demo/Presentation</h3>
    <ul>
        <li>☐ Show CRUD working</li>
        <li>☐ Show data appears on multiple nodes after insert</li>
        <li>☐ Show concurrency test results with different isolation levels</li>
        <li>☐ Show recovery: stop node → do operation → show pending → restart → recover → show success</li>
    </ul>

    <hr>

    <h2>Isolation Levels (for dropdown)</h2>
    <ul>
        <li><strong>READ UNCOMMITTED</strong> - Can see uncommitted data (dirty reads)</li>
        <li><strong>READ COMMITTED</strong> - Only sees committed data (recommended default)</li>
        <li><strong>REPEATABLE READ</strong> - Same read = same result within transaction</li>
        <li><strong>SERIALIZABLE</strong> - Full isolation, slowest</li>
    </ul>

    <hr>

    <h2>Sample Response Formats</h2>

    <h3>GET /health</h3>
    <pre>{
  "node1": {"status": "online", "healthy": true, "record_count": 10000},
  "node2": {"status": "online", "healthy": true, "record_count": 5000},
  "node3": {"status": "offline", "healthy": false}
}</pre>

    <h3>GET /titles</h3>
    <pre>{
  "data": [{"tconst": "tt0000001", "title_type": "movie", "primary_title": "...", ...}],
  "total": 10000,
  "page": 1,
  "limit": 20,
  "source": "node1"
}</pre>

    <h3>POST /title (Create)</h3>
    <pre>// Request body:
{
  "tconst": "tt9999999",
  "title_type": "movie",
  "primary_title": "Test Movie",
  "start_year": 2024,
  "runtime_minutes": 120,
  "genres": "Action,Comedy"
}

// Response:
{
  "success": true,
  "primary_node": "node2",
  "replicated_to": "node1",
  "message": "Insert committed to node2 and replicated to node1"
}</pre>

    <h3>POST /test/concurrent-read</h3>
    <pre>{
  "test": "concurrent_read",
  "isolation_level": "READ COMMITTED",
  "tconst": "tt0000001",
  "results": {
    "node1": {"success": true, "data": {...}, "read_time": 0.05},
    "node2": {"success": true, "data": {...}, "read_time": 0.04}
  },
  "consistent": true
}</pre>

    <h3>GET /recovery/status</h3>
    <pre>{
  "total_pending": 3,
  "by_node": {
    "node1": {"status": "online", "pending_count": 0},
    "node2": {"status": "online", "pending_count": 2, "pending_by_target": {"node1": 2}},
    "node3": {"status": "offline", "pending_count": 1}
  },
  "automatic_retry_active": true
}</pre>

</body>
</html>