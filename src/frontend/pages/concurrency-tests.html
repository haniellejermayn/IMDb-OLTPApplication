<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Concurrency Tests</title>
    <link rel="stylesheet" href="../public/css/general.css" />
    <link rel="stylesheet" href="../public/css/concurrency-tests.css" />
  </head>
  <body>
    <div class="container">
      <div class="top-row">
        <h1>CONCURRENCY TESTS</h1>
        <a id="back" href="/">Back to Dashboard</a>
      </div>

      <div class="break"></div>

      <div class="case-options-container">
        <button class="case-option text-main" id="case-1-option">
          <b>Case 1</b>
        </button>
        <button class="case-option text-main" id="case-2-option">
          <b>Case 2</b>
        </button>
        <button class="case-option text-main" id="case-3-option">
          <b>Case 3</b>
        </button>
      </div>

      <div class="case-data-container" id="case-1">
        <div class="case-header">
          <h2>Case #1</h2>
          <p>
            Concurrent transactions in two or more nodes are reading the same
            data item.
          </p>
          <div class="break"></div>
        </div>

        <form id="case-1-form">
          <label for="tconst">TCONST:</label>
          <input
            type="text"
            id="tconst"
            name="tconst"
            placeholder="tt0035423"
            required
          />

          <br />

          <label for="isolation-level">Isolation Level:</label>
          <select name="isolation-level" id="isolation-level">
            <option value="SERIALIZABLE">Serializable</option>
            <option value="REPEATABLE READ">Repeatable Read</option>
            <option value="READ COMMITTED">Read Committed</option>
            <option value="READ UNCOMMITTED">Read Uncommitted</option>
          </select>

          <button type="submit">Submit</button>
        </form>

        <div class="break"></div>

        <h2>Results</h2>

        <div class="node-results-container"></div>

        <div class="results-analysis" style="display: none">
          <h2 id="case1-consistency-val" class="consistency"></h2>
          <p class="explanation"></p>
        </div>

        <div class="json-response">
          <h2>JSON Response</h2>
          <div class="json-content"></div>
        </div>
      </div>

      <div class="case-data-container" id="case-2" style="display: none">
        <div class="case-header">
          <h2>Case #2</h2>
          <p>
            At least one transaction in the three nodes is writing (update /
            delete) and the other concurrent transactions are reading the same
            data item.
          </p>
          <p>For this case, we will test it on editing runtime minutes.</p>
          <div class="break"></div>
        </div>

        <form id="case-2-form">
          <label for="case-2-tconst">TCONST:</label>
          <input
            type="text"
            id="case-2-tconst"
            name="tconst"
            placeholder="tt0035423"
            required
          />

          <div>
            <label for="case-2-runtime_minutes">Runtime Minutes:</label>
            <input
              type="number"
              id="case-2-runtime_minutes"
              name="runtime_minutes"
              placeholder="148"
            />
          </div>

          <br />

          <label for="case-2-isolation-level">Isolation Level:</label>
          <select name="isolation-level" id="case-2-isolation-level">
            <option value="SERIALIZABLE">Serializable</option>
            <option value="REPEATABLE READ">Repeatable Read</option>
            <option value="READ COMMITTED">Read Committed</option>
            <option value="READ UNCOMMITTED">Read Uncommitted</option>
          </select>

          <div class="last-row">
            <div class="result" style="margin-top: 1rem"></div>
            <button type="submit">Submit</button>
          </div>
        </form>

        <div class="break"></div>

        <h2>Results</h2>

        <div id="case2-node-results-container" class="node-results-container" style="display: none">
          <div id="case2-original-value-section" class="original-value">
            <h3>Original Value</h3>
            <div
              id="case2-original-value-container"
              class="node-result original-value-container"
            ></div>
          </div>

          <div id="case2-readers-section" class="readers">
            <h3>Readers</h3>
            <div id="case2-readers-container" class="readers-container"></div>
          </div>

          <div id="case2-writers-section" class="writers">
            <h3>Writers</h3>
            <div id="case2-writers-container" class="write-content-container"></div>
          </div>

          <div id="case2-final-values-section" class="final-values">
            <h3>Final Values</h3>
            <div
              id="case2-final-values-container"
              class="final-values-container"
            ></div>
          </div>
        </div>

        <div id="case2-result-analysis" class="results-analysis" style="display: none">
          <h2 id="consistency-val" class="consistency"></h2>
          <div id="explanation-val" class="explanation"></div>

          <div class="analysis-breakdown">
            <h3>Analysis Breakdown:</h3>

            <div class="analysis-breakdown-content">
              <div class="anomaly-occurrences">
                <p class="dirty-read-anomaly">
                  <b>Dirty Read Occurred:</b> <span id="dirty-read-val"></span>
                </p>

                <p class="non-repeatable-read-anomaly">
                  <b>Non-Repeatable Reads:</b> <span id="nonrepeat-val"></span>
                </p>

                <p class="blocking-anomaly">
                  <b>Blocking Occurred:</b> <span id="blocking-val"></span>
                </p>
              </div>
              <div class="read-write-operations">
                <div class="top">
                  <p class="operation-status readers-succeeded">
                    <b>Successful Readers:</b> <span id="readers-count"></span>
                  </p>
                  <h6 class="avg-duration-readers">
                    <span id="readers-duration"></span>
                  </h6>
                </div>
                <div class="bottom">
                  <p class="operation-status writers-succeeded">
                    <b>Successful Writers:</b> <span id="writers-count"></span>
                  </p>
                  <h6 class="avg-duration-writers">
                    <span id="writers-duration"></span>
                  </h6>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="json-response-c2" class="json-response">
          <h2>JSON Response</h2>
          <div id="json-content-c2" class="json-content"></div>
        </div>
      </div>

      <div class="case-data-container" id="case-3" style="display: none">
        <h2>Case #3</h2>
        <p>Concurrent transactions in two or more nodes are writing (update / delete) the same data item.</p>
        <p>For this case, we will test it on editing runtime minutes and genres.</p>
        <div class="break"></div>

        <form id="case-3-form">
          <label for="case-3-tconst">TCONST:</label>
          <input
            type="text"
            id="case-3-tconst"
            name="tconst"
            placeholder="tt0035423"
            required
          />

          <div>
            <label for="case-3-runtime_minutes_1">[1] Runtime Minutes:</label>
            <input
              type="number"
              id="case-3-runtime_minutes_1"
              name="runtime_minutes"
              placeholder="148"
            />
          </div>
          <div>
            <label for="case-3-genres_1">[1] Genres (comma-separated):</label>
            <input
              type="text"
              id="case-3-genres_1"
              name="runtime_minutes"
              placeholder="Thriller"
            />
          </div>
          
          <div>
            <label for="case-3-runtime_minutes_2">[2] Runtime Minutes:</label>
            <input
              type="number"
              id="case-3-runtime_minutes_2"
              name="runtime_minutes"
              placeholder="148"
            />
          </div>
          <div>
            <label for="case-3-genres_2">[2] Genres (comma-separated):</label>
            <input
              type="text"
              id="case-3-genres_2"
              name="runtime_minutes"
              placeholder="Thriller"
            />
          </div>
          
          <div>
            <label for="case-3-runtime_minutes_3">[3] Runtime Minutes:</label>
            <input
              type="number"
              id="case-3-runtime_minutes_3"
              name="runtime_minutes"
              placeholder="148"
            />
          </div>
          <div>
            <label for="case-3-genres_3">[3] Genres (comma-separated):</label>
            <input
              type="text"
              id="case-3-genres_3"
              name="runtime_minutes"
              placeholder="Thriller"
            />
          </div>

          <br />

          <label for="case-3-isolation-level">Isolation Level:</label>
          <select name="isolation-level" id="case-3-isolation-level">
            <option value="SERIALIZABLE">Serializable</option>
            <option value="REPEATABLE READ">Repeatable Read</option>
            <option value="READ COMMITTED">Read Committed</option>
            <option value="READ UNCOMMITTED">Read Uncommitted</option>
          </select>

          <div class="last-row">
            <div class="result" style="margin-top: 1rem"></div>
            <button type="submit">Submit</button>
          </div>
        </form>

        <div class="break"></div>

        <h2>Results</h2>

        <div class="node-results-container" id="case3-node-results-container" style="display: none">
            
            <div id="case3-writers-section" class="writers">
                <h3>Writers</h3>
                <div id="case3-writers-container" class="write-content-container"></div>
            </div>

            <div id="case3-final-values-section" class="final-values">
                <h3>Final Values</h3>
                <div
                id="case3-final-values-container"
                class="final-values-container"
                ></div>
            </div>

        </div>

        <div id="c3-explanation" class="results-analysis" style="display: none">
          <h2 id="consistency-val-c3" class="consistency"></h2>
          <div id="explanation-val-c3" class="explanation"></div>

          <div class="analysis-breakdown">
            <h3>Analysis Breakdown:</h3>

            <div class="analysis-breakdown-content">
              <div class="anomaly-occurrences">
                <p class="blocking-anomaly">
                  <b>Blocking Occurred:</b> <span id="blocking-val-c3"></span>
                </p>

                <p class="deadlock-anomaly">
                  <b>Deadlocks Detected:</b> <span id="deadlock-val"></span>
                </p>

                <p class="serialization-anomaly">
                  <b>Serialization Enforced:</b> <span id="serialization-val"></span>
                </p>
              </div>
              <div class="read-write-operations">
                <div class="top">
                  <p class="operation-status writes-failed">
                    <b>Failed Writes: </b> <span id="failed-writes-count"></span>
                  </p>
                </div>
                <div class="bottom">
                  <p class="operation-status writers-succeeded">
                    <b>Successful Writes: </b> <span id="successful-writes-count"></span>
                  </p>
                  <h6 class="avg-duration-writers">
                    <span id="writers-duration"></span>
                  </h6>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="json-response-c3" class="json-response">
          <h2>JSON Response</h2>
          <div id="json-content-c3" class="json-content"></div>
        </div>

      </div>
    </div>

    <script src="../public/js/concurrency-tests-script.js"></script>
  </body>
</html>
